## coding=utf-8

## This is the main Mako template that all page templates should include.
## Note: there are a handful of pages that use Django Templates and which
## instead include main_django.html. It is important that these two files
## remain in sync, so changes made in one should be applied to the other.

## Pages currently use v1 styling by default. Once the Pattern Library
## rollout has been completed, this default can be switched to v2.
<%! main_css = "style-main-v1" %>

<%namespace name='static' file='static_content.html'/>
<% online_help_token = self.online_help_token() if hasattr(self, 'online_help_token') else None %>
<%!
from django.core.urlresolvers import reverse
from django.utils.http import urlquote_plus
from django.utils.translation import ugettext as _
from django.utils.translation import get_language_bidi
from branding import api as branding_api
from pipeline_mako import render_require_js_path_overrides
%>
<!DOCTYPE html>
<!--[if lte IE 9]><html class="ie ie9 lte9" lang="${LANGUAGE_CODE}"><![endif]-->
<!--[if !IE]><!--><html lang="${LANGUAGE_CODE}"><!--<![endif]-->
<head dir="${static.dir_rtl()}">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

## Define a couple of helper functions to make life easier when
## embedding theme conditionals into templates. All inheriting
## templates have access to these functions, and we can import these
## into non-inheriting templates via the %namespace tag.

## this needs to be here to prevent the title from mysteriously appearing in the body, in one case
<%def name="pagetitle()" />
  <%block name="title">
      <title>
       ${static.get_page_title_breadcrumbs(self.pagetitle())}
      </title>
  </%block>

  % if not allow_iframing:
      <script type="text/javascript">
        /* immediately break out of an iframe if coming from the marketing website */
        (function(window) {
          if (window.location !== window.top.location) {
            window.top.location = window.location;
          }
        })(this);
      </script>
  % endif

  <%
    jsi18n_path = "js/i18n/{language}/djangojs.js".format(language=LANGUAGE_CODE)
  %>

  <script type="text/javascript" src="${static.url(jsi18n_path)}"></script>

  <link rel="icon" type="image/x-icon" href="${static.url(static.get_value('favicon', settings.FAVICON_PATH))}" />

  <%static:css group='style-vendor'/>
  <%static:css group='${self.attr.main_css}'/>

  % if not uses_pattern_library:
    % if disable_courseware_js:
      <%static:js group='base_vendor'/>
      <%static:js group='base_application'/>
    % else:
      <%static:js group='main_vendor'/>
      <%static:js group='application'/>
    % endif
  % else:
    ## TODO: Update to only bring in RequireJS
    ## https://openedx.atlassian.net/browse/FEDX-140
    <%static:js group='base_vendor'/>
    <%static:js group='base_application'/>
  % endif

  <script>
    window.baseUrl = "${settings.STATIC_URL}";
    (function (require) {
      require.config({
          baseUrl: window.baseUrl
      });
    }).call(this, require || RequireJS.require);
  </script>
  <script type="text/javascript" src="${static.url("lms/js/require-config.js")}"></script>
  <%block name="js_overrides">
    ${render_require_js_path_overrides(settings.REQUIRE_JS_PATH_OVERRIDES)}
  </%block>
  % if not disable_courseware_js:
    <%static:js group='module-js'/>
  % endif

  <%block name="headextra"/>

  <%static:optional_include_mako file="head-extra.html" is_theming_enabled="True" />

  <%include file="widgets/optimizely.html" />
  <%include file="widgets/segment-io.html" />
  <meta name="path_prefix" content="${EDX_ROOT_URL}">
  <meta name="google-site-verification" content="_mipQ4AtZQDNmbtOkwehQDOgCxUUV2fb_C0b6wbiRHY" />

<%
org = static.get_value('domain_prefix')
css = org+'/css/dashboard.css'
css = '/media/microsite/{}/auto/css/customizer.css'.format(org)
%>
<link rel="stylesheet" type="text/css" href="${css}">
<script type="text/javascript" src="${static.url('js/customize.js')}"></script>
<script type="text/javascript" src="${static.url('js/initialize.js')}"></script>

<!-- fonts call -->
<style>
@font-face {
  font-family: 'custom_font';
  src: url("/media/microsite/champagne-mooc/fonts/CIVCSansLight.ttf");
  font-weight: normal;
}
</style>


    
% if static.get_value('google_font') is not None:
<%
font_string = static.get_value('google_font')
font_name = font_string.replace('<link href="https://fonts.googleapis.com/css?family=','').replace('rel="stylesheet">','').replace('"','').replace(' ','').replace('+',' ')
%>
${font_string | n}
<style>
  *, div, span, section, h1, h2, h3, h4, h5, h6, p, header {
    font-family:"custom_font" !important;
  }
</style>
% else:
<style>
@font-face{
  font-family:"custom_font";
  src:url("/static/sncf/fonts/avenir.ttf") format("truetype"),
      url("/static/sncf/fonts/avenir.woff'") format("woff"),
      url("/static/sncf/fonts/avenir.eot") ,
      url("/static/sncf/fonts/avenir.eot?#iefix") format("embedded-opentype");
  }
</style>
% endif    
<style>
  /*Font*/
  @font-face {
    font-family: 'Socicon';
    src: url("${static.url(org+'/fonts/Socicon.eot')}");
    src: url("${static.url(org+'/fonts/Socicon.eot#iefix')}")format('embedded-opentype'), url("{static.url(org+'/fonts/Socicon.woff2')}") format('woff2'), url("{static.url(org+'/fonts/Socicon.ttf')}") format('truetype'), url("{static.url(org+'/fonts/Socicon.woff')}") format('woff'), url("{static.url(org+'/fonts/Socicon.svg#Socicon')}") format('svg');
    font-weight: normal;
    font-style: normal;
  }
</style>
<style>
.icon {
 font: normal normal normal 14px/1 FontAwesome !important;
}
.dashboard .my-courses .course .details .course-actions .wrapper-action-more .action-more{
font: normal 1.2rem/1.6rem "Open Sans",Verdana,Geneva,sans-serif,sans-serif !important;
}
.fa {
 font: normal normal normal 14px/1 FontAwesome !important;
}
</style>   
</head>

<!-- url API polyfill -->
<script>
  (function(t){var e=function(){try{return!!Symbol.iterator}catch(e){return false}};var r=e();var n=function(t){var e={next:function(){var e=t.shift();return{done:e===void 0,value:e}}};if(r){e[Symbol.iterator]=function(){return e}}return e};var i=function(e){return encodeURIComponent(e).replace(/%20/g,"+")};var o=function(e){return decodeURIComponent(String(e).replace(/\+/g," "))};var a=function(){var a=function(e){Object.defineProperty(this,"_entries",{writable:true,value:{}});var t=typeof e;if(t==="undefined"){}else if(t==="string"){if(e!==""){this._fromString(e)}}else if(e instanceof a){var r=this;e.forEach(function(e,t){r.append(t,e)})}else if(e!==null&&t==="object"){if(Object.prototype.toString.call(e)==="[object Array]"){for(var n=0;n<e.length;n++){var i=e[n];if(Object.prototype.toString.call(i)==="[object Array]"||i.length!==2){this.append(i[0],i[1])}else{throw new TypeError("Expected [string, any] as entry at index "+n+" of URLSearchParams's input")}}}else{for(var o in e){if(e.hasOwnProperty(o)){this.append(o,e[o])}}}}else{throw new TypeError("Unsupported input's type for URLSearchParams")}};var e=a.prototype;e.append=function(e,t){if(e in this._entries){this._entries[e].push(String(t))}else{this._entries[e]=[String(t)]}};e.delete=function(e){delete this._entries[e]};e.get=function(e){return e in this._entries?this._entries[e][0]:null};e.getAll=function(e){return e in this._entries?this._entries[e].slice(0):[]};e.has=function(e){return e in this._entries};e.set=function(e,t){this._entries[e]=[String(t)]};e.forEach=function(e,t){var r;for(var n in this._entries){if(this._entries.hasOwnProperty(n)){r=this._entries[n];for(var i=0;i<r.length;i++){e.call(t,r[i],n,this)}}}};e.keys=function(){var r=[];this.forEach(function(e,t){r.push(t)});return n(r)};e.values=function(){var t=[];this.forEach(function(e){t.push(e)});return n(t)};e.entries=function(){var r=[];this.forEach(function(e,t){r.push([t,e])});return n(r)};if(r){e[Symbol.iterator]=e.entries}e.toString=function(){var r=[];this.forEach(function(e,t){r.push(i(t)+"="+i(e))});return r.join("&")};t.URLSearchParams=a};var s=function(){try{var e=t.URLSearchParams;return new e("?a=1").toString()==="a=1"&&typeof e.prototype.set==="function"}catch(e){return false}};if(!s()){a()}var f=t.URLSearchParams.prototype;if(typeof f.sort!=="function"){f.sort=function(){var r=this;var n=[];this.forEach(function(e,t){n.push([t,e]);if(!r._entries){r.delete(t)}});n.sort(function(e,t){if(e[0]<t[0]){return-1}else if(e[0]>t[0]){return+1}else{return 0}});if(r._entries){r._entries={}}for(var e=0;e<n.length;e++){this.append(n[e][0],n[e][1])}}}if(typeof f._fromString!=="function"){Object.defineProperty(f,"_fromString",{enumerable:false,configurable:false,writable:false,value:function(e){if(this._entries){this._entries={}}else{var r=[];this.forEach(function(e,t){r.push(t)});for(var t=0;t<r.length;t++){this.delete(r[t])}}e=e.replace(/^\?/,"");var n=e.split("&");var i;for(var t=0;t<n.length;t++){i=n[t].split("=");this.append(o(i[0]),i.length>1?o(i[1]):"")}}})}})(typeof global!=="undefined"?global:typeof window!=="undefined"?window:typeof self!=="undefined"?self:this);(function(h){var e=function(){try{var e=new h.URL("b","http://a");e.pathname="c d";return e.href==="http://a/c%20d"&&e.searchParams}catch(e){return false}};var t=function(){var t=h.URL;var e=function(e,t){if(typeof e!=="string")e=String(e);var r=document,n;if(t&&(h.location===void 0||t!==h.location.href)){r=document.implementation.createHTMLDocument("");n=r.createElement("base");n.href=t;r.head.appendChild(n);try{if(n.href.indexOf(t)!==0)throw new Error(n.href)}catch(e){throw new Error("URL unable to set base "+t+" due to "+e)}}var i=r.createElement("a");i.href=e;if(n){r.body.appendChild(i);i.href=i.href}if(i.protocol===":"||!/:/.test(i.href)){throw new TypeError("Invalid URL")}Object.defineProperty(this,"_anchorElement",{value:i});var o=new h.URLSearchParams(this.search);var a=true;var s=true;var f=this;["append","delete","set"].forEach(function(e){var t=o[e];o[e]=function(){t.apply(o,arguments);if(a){s=false;f.search=o.toString();s=true}}});Object.defineProperty(this,"searchParams",{value:o,enumerable:true});var c=void 0;Object.defineProperty(this,"_updateSearchParams",{enumerable:false,configurable:false,writable:false,value:function(){if(this.search!==c){c=this.search;if(s){a=false;this.searchParams._fromString(this.search);a=true}}}})};var r=e.prototype;var n=function(t){Object.defineProperty(r,t,{get:function(){return this._anchorElement[t]},set:function(e){this._anchorElement[t]=e},enumerable:true})};["hash","host","hostname","port","protocol"].forEach(function(e){n(e)});Object.defineProperty(r,"search",{get:function(){return this._anchorElement["search"]},set:function(e){this._anchorElement["search"]=e;this._updateSearchParams()},enumerable:true});Object.defineProperties(r,{toString:{get:function(){var e=this;return function(){return e.href}}},href:{get:function(){return this._anchorElement.href.replace(/\?$/,"")},set:function(e){this._anchorElement.href=e;this._updateSearchParams()},enumerable:true},pathname:{get:function(){return this._anchorElement.pathname.replace(/(^\/?)/,"/")},set:function(e){this._anchorElement.pathname=e},enumerable:true},origin:{get:function(){var e={"http:":80,"https:":443,"ftp:":21}[this._anchorElement.protocol];var t=this._anchorElement.port!=e&&this._anchorElement.port!=="";return this._anchorElement.protocol+"//"+this._anchorElement.hostname+(t?":"+this._anchorElement.port:"")},enumerable:true},password:{get:function(){return""},set:function(e){},enumerable:true},username:{get:function(){return""},set:function(e){},enumerable:true}});e.createObjectURL=function(e){return t.createObjectURL.apply(t,arguments)};e.revokeObjectURL=function(e){return t.revokeObjectURL.apply(t,arguments)};h.URL=e};if(!e()){t()}if(h.location!==void 0&&!("origin"in h.location)){var r=function(){return h.location.protocol+"//"+h.location.hostname+(h.location.port?":"+h.location.port:"")};try{Object.defineProperty(h.location,"origin",{get:r,enumerable:true})}catch(e){setInterval(function(){h.location.origin=r()},100)}}})(typeof global!=="undefined"?global:typeof window!=="undefined"?window:typeof self!=="undefined"?self:this);
</script>
<!-- END url API polyfill -->

<body class="${static.dir_rtl()} <%block name='bodyclass'/> lang_${LANGUAGE_CODE}">

<span id="tma_background_font"></span>
<%static:optional_include_mako file="body-initial.html" is_theming_enabled="True" />
<div id="page-prompt"></div>
% if not disable_window_wrap:
  <div class="window-wrap" dir="${static.dir_rtl()}">
% endif
    <a class="nav-skip" href="#main">${_("Skip to main content")}</a>

    % if not disable_header:
        <%include file="${static.get_template_path('header.html')}" args="online_help_token=online_help_token" />
    % endif

    <div class="content-wrapper" id="content">
      ${self.body()}
      <%block name="bodyextra"/>
    </div>

    % if not disable_footer:
        <%include file="${static.get_template_path('footer.html')}" />
    % endif

% if not disable_window_wrap:
  </div>
% endif

  <%block name="js_extra"/>

  <%include file="widgets/segment-io-footer.html" />
  <script type="text/javascript" src="${static.url('js/vendor/noreferrer.js')}" charset="utf-8"></script>
  <script type="text/javascript" src="${static.url('js/utils/navigation.js')}" charset="utf-8"></script>
  <%static:optional_include_mako file="body-extra.html" is_theming_enabled="True" />
</body>
</html>

<%def name="login_query()">${
  u"?next={0}".format(urlquote_plus(login_redirect_url)) if login_redirect_url else ""
}</%def>

<!-- Performance beacon for onload times -->
% if settings.FEATURES.get('ENABLE_ONLOAD_BEACON', False):
<script>
  (function () {
    var sample_rate = ${settings.ONLOAD_BEACON_SAMPLE_RATE};
    var roll = Math.floor(Math.random() * 100)/100;
    var onloadBeaconSent = false;

    if(roll < sample_rate){
      $(window).load(function() {
        setTimeout(function(){
          var t = window.performance.timing;

          var data = {
            event: "onload",
            value: t.loadEventEnd - t.navigationStart,
            page: window.location.href,
          };

          if (!onloadBeaconSent) {
            $.ajax({method: "POST", url: "/performance", data: data});
          }
          onloadBeaconSent = true;
        }, 0);
      });
    }
  }());
</script>
% endif
<script>
setInterval(function(){
  $(".problem-progress").each(function() {
    $(this).html($(this).html().replace("(ungraded)",""));
  });
  if(window.location.href.indexOf('/courseware/')>-1){
    $(".problem-progress").each(function() {
      $(this).html($(this).html().replace("(ungraded)",""));
      $(this).html($(this).html().replace("notés","noté"));
    });
    $(".poll-voting-thanks span").each(function() {
      $(this).html($(this).html().replace("Thank you","Merci"));
    });
    $(".title1").each(function() {
      $(this).html($(this).html().replace("Feedback","Commentaire"));
      $(this).html($(this).html().replace("Problem",""));
    });
    $(".unbutton.btn-default.btn-small.keyboard-help-button").each(function() {
      $(this).css("display","none");
    });
    $(".unbutton.btn-link.keyboard-help-button").each(function() {
      $(this).css("display","none");
    });
    $(".view-results-button").each(function() {
       $(this).html($(this).html().replace("View results","Voir les r&eacute;sultats"));
    });
    $(".poll-header").each(function() {
       $(this).html($(this).html().replace("Results","R&eacute;sultats"));
    });
    $(".poll-footnote").each(function() {
       $(this).html($(this).html().replace("Results gathered from ","R&eacute;sultats sur un total de "));
       $(this).html($(this).html().replace("respondent","r&eacute;pondant"));
    });
    $("h3.poll-header").each(function() {
      $(this).html($(this).html().replace("Feedback","Commentaire"));
    });
    $("input.input-main").each(function() {
       $(this).attr("value",$(this).attr("value").replace("Submit","Soumettre"));
    });
    $(".message__content").each(function() {
       $(this).html($(this).html().replace("Your Response"," Votre r&eacute;ponse"));
    });
    $("p.message").each(function() {
       $(this).html($(this).html().replace("Drag the items onto the image above.","D&eacute;posez les items sur l'image"));
    });
    $(".action.action--save.submission__save").each(function() {
       $(this).html($(this).html().replace("Save your progress","Sauvegarder votre progression"));
    });
    $("h2.bookmarks-results-header").each(function() {
       $(this).html($(this).html().replace("My Bookmarks","Mes favoris"));
    });
    $(".unbutton.btn-default.btn-small.reset-button").each(function() {
       $(this).html($(this).html().replace("Reset","Réinitialiser"));
    });
  }
  if(window.location.href.indexOf('/forum')>-1){
    $(".field-help").each(function() {
      $(this).html($(this).html().replace("Add your post to a relevant topic to help others find it.","Ajoutez votre message sur le bon sujet pour aider les autres à le trouver"));
      $(this).html($(this).html().replace("Questions raise issues that need answers. Discussions share ideas and start conversations.","Utilisez les 'Questions' si vous attendez une réponse. Les 'Discussions' servent à lancer des conversations."));
      $(this).html($(this).html().replace("Add a clear and descriptive title to encourage participation.","Ajoutez un titre clair et descriptif pour favoriser la participation"));
    });
    $("#new-post-editor-description").each(function() {
      $(this).html($(this).html().replace("Your question or idea","Votre question ou idée"));
    });
    $(".posted-details").each(function() {
      $(this).html($(this).html().replace("discussion posted ","posté"));
      $(this).html($(this).html().replace(" by "," par "));
    });
    $(".user-roles").each(function() {
      $(this).css('display','none');
    });
  }
},500);
</script>

<style>
.xmodule_display.xmodule_CapaModule div.problem div p.answer:before{
 content: "Solution:";
}
</style>
