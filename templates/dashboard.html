<%page expression_filter="h"/>
<%inherit file="main.html" />
<%def name="online_help_token()"><% return "learnerdashboard" %></%def>
<%namespace name='static' file='static_content.html'/>
<%!
from django.core.urlresolvers import reverse
from django.utils.translation import ugettext as _
from django.template import RequestContext
import third_party_auth
from third_party_auth import pipeline
from openedx.core.djangolib.js_utils import dump_js_escaped_json, js_escaped_string
from openedx.core.djangolib.markup import HTML, Text
#GEOFFREY
from courseware.courses import get_course_info_section, get_course_date_blocks
from courseware.courses import get_course_by_id
from openedx.core.djangoapps.user_api.accounts.image_helpers import get_profile_image_urls_for_user
from lms.djangoapps.grades.new.course_grade import CourseGradeFactory
from cms.djangoapps.models.settings.course_grading import CourseGradingModel
from xmodule.modulestore.django import modulestore
from course_api.blocks.api import get_blocks
#from discussion_tma.views import get_section_list
import time
import json

from lms.djangoapps.tma_apps.netexplo.utils import was_previously_succeeded_on_upro_academy

%>

<%
  cert_name_short = settings.CERT_NAME_SHORT
  cert_name_long = settings.CERT_NAME_LONG
%>

<%
org_static = static.get_value('domain_prefix')
css = '/media/microsite/{}/auto/css/dashboard.css'.format(org_static)
css_bis = '/media/microsite/{}/auto/css/dashboard_multi.css'.format(org_static)
%>

<%block name="pagetitle">${_("Dashboard")}</%block>
<%block name="bodyclass">view-dashboard is-authenticated</%block>

<%block name="header_extras">
% for template_name in ["donation"]:
<script type="text/template" id="${template_name}-tpl">
  <%static:include path="dashboard/${template_name}.underscore" />
</script>
% endfor

% for template_name in ["dashboard_search_item", "dashboard_search_results", "search_loading", "search_error"]:
<script type="text/template" id="${template_name}-tpl">
    <%static:include path="search/${template_name}.underscore" />
</script>
% endfor
</%block>

<style>
/* Tooltip container */
.tooltip {
  position: relative;
  display: inline-block;
  cursor:pointer;
  text-decoration: underline;
}

/* Tooltip text */
.tooltip .tooltiptext {
  visibility: hidden;
  margin-left:82px;
  width: 200px;
  background-color: black;
  color: #fff;
  text-align: center;
  padding: 10px;
  border-radius: 6px;
  line-height: 16px;
  /* Position the tooltip text - see examples below! */
  position: absolute;
  z-index: 1;
}

.tooltip .tooltiptext::after {
  content: " ";
  position: absolute;
  bottom: 100%;  /* At the top of the tooltip */
  left: 10%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent black transparent;
}

/* Show the tooltip text when you mouse over the tooltip container */
.tooltip:hover .tooltiptext {
  visibility: visible;
}
</style>


<%
custom_fields = {}
custom_fields = json.loads(user.profile.custom_field)
%>

% if not 'bnpp_entity' in custom_fields.keys() or not 'bnpp_country' in custom_fields.keys():
%if request.LANGUAGE_CODE == 'fr':
<script>
  var confirmButtonText = 'Valider'
  var cancelButtonText = 'Annuler'
  var titleQuestion1 = 'Pays'
  var textQuestion1 = 'Sélectionnez votre pays'
  var optionOther = 'Autre'
  var titleQuestion2 = 'Entité'
  var textQuestion2 = 'Sélectionnez votre entité'
  var updateCompleted = 'Vos informations ont bien été enregistrées'
  var footerText = '<ul><li><sup>*1</sup> inclut : Cetelem, Cofinoga, Findomestic, Alphacredit, RCS, Sevendays Finans, Express Bank</li>'
  +'<br /><li><sup>*2</sup> inclut : Banque Privée France</li>'
  +'<br /><li><sup>*3</sup> inclut : Bank of the West, BMCI, BNP Paribas Polska, TEB, Ukrsibbank, BICICI, BICIS</li></ul>'
</script>
%else:
<script>
  var confirmButtonText = 'Validate'
  var cancelButtonText = 'Cancel'
  var titleQuestion1 = 'Country'
  var textQuestion1 = 'Select your country'
  var optionOther = 'Other'
  var titleQuestion2 = 'Entity'
  var textQuestion2 = 'Select your entity'
  var updateCompleted = 'Your information have been saved'
  var footerText = '<ul><li><sup>*1</sup> including: Cetelem, Cofinoga, Findomestic, Alphacredit, RCS, Sevendays Finans, Express Bank</li>'
  +'<br /><li><sup>*2</sup> including: Banque Privée France</li>'
  +'<br /><li><sup>*3</sup> including: Bank of the West, BMCI, BNP Paribas Polska, TEB, Ukrsibbank, BICICI, BICIS</li></ul>'
</script>
%endif
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script>
  $( document ).ready(function() {
    Swal.mixin({
      input: 'text',
      confirmButtonText: confirmButtonText,
      cancelButtonText: cancelButtonText,
      confirmButtonColor: '#9BE7D8',
      cancelButtonColor: '#bec5c4',
      showCancelButton: true,
      progressSteps: ['1', '2']
    }).queue([
      {
        title: titleQuestion1,
        text: textQuestion1,
        input: 'select',
        inputValue: 'France',
        inputOptions: {
          'Africa': {
            BurkinaFaso: 'Burkina Faso',
            Botswana: 'Botswana',
            IvoryCoast: 'Ivory Coast',
            Algeria: 'Algeria',
            Gabon: 'Gabon',
            Guinea: 'Guinea',
            Comoros: 'Comoros',
            Morocco: 'Morocco',
            Mali: 'Mali',
            Namibia: 'Namibia',
            Senegal: 'Senegal',
            Tunisia: 'Tunisia',
            SouthAfrica: 'South Africa'
          },
          'Asia - Oceania': {
            Australia: 'Australia',
            China: 'China',
            HongKong: 'Hong Kong',
            Indonesia: 'Indonesia',
            India: 'India',
            Japan: 'Japan',
            SouthKorea: 'South Korea',
            Malaysia: 'Malaysia',
            NewZealand: 'New Zealand',
            Philippines: 'Philippines',
            Singapore: 'Singapore',
            Thailand: 'Thailand',
            Taiwan: 'Taiwan',
            VietNam: 'Viet Nam'
          },
          'Europe (France excluded)': {
            Austria: 'Austria',
            Belgium: 'Belgium',
            Bulgaria: 'Bulgaria',
            Switzerland: 'Switzerland',
            CzechRepublic: 'Czech Republic',
            Germany: 'Germany',
            Denmark: 'Denmark',
            Spain: 'Spain',
            Finland: 'Finland',
            UnitedKingdom: 'United Kingdom',
            Guernsey: 'Guernsey',
            Greece: 'Greece',
            Hungary: 'Hungary',
            Ireland: 'Ireland',
            Italy: 'Italy',
            Jersey: 'Jersey',
            Luxembourg: 'Luxembourg',
            Monaco: 'Monaco',
            Netherlands: 'Netherlands',
            Norway: 'Norway',
            Poland: 'Poland',
            Portugal: 'Portugal',
            Romania: 'Romania',
            Serbia: 'Serbia',
            Russia: 'Russia',
            Sweden: 'Sweden',
            Slovakia: 'Slovakia',
            Turkey: 'Turkey',
            Ukraine: 'Ukraine',
          },
          'France & Outremer': {
            France: 'France',
          },
          'Middle East': {
            UnitedArabEmirates: 'United Arab Emirates',
            Bahrain: 'Bahrain',
            Israel: 'Israel',
            Kuwait: 'Kuwait',
            Qatar: 'Qatar',
            SaudiArabia: 'Saudi Arabia'
          },
          'North America': {
            Canada: 'Canada',
            UnitedStates: 'United States',
            Argentina: 'Argentina',
            Brazil: 'Brazil',
            Chile: 'Chile',
            Colombia: 'Colombia',
            CaymanIslands: 'Cayman Islands',
            Mexico: 'Mexico',
            Peru: 'Peru'
          }
        }
      },
      {
        title: titleQuestion2,
        text: textQuestion2,
        input: 'select',
        footer: footerText,
        inputOptions: {
            BNPParibasPersonalFinance: 'BNP Paribas Personal Finance<sup> *1</sup>',
            BNPParibasCardif: 'BNP Paribas Cardif',
            BNPParibasRealEstate: 'BNP Paribas Real Estate',
            BNPParibasWealthManagement: 'BNP Paribas Wealth Management<sup> *2</sup>',
            BNPParibasAssetManagement: 'BNP Paribas Asset Management',
            IRBInternationalRetailBanking: 'IRB – International Retail Banking<sup> *3</sup>',
            GroupCompliance: 'Group Compliance',
            BDDFBanquededetailenFrance: 'BDDF – Banque de détail en France',
            BGLLuxembourg: 'BGL – Luxembourg',
            BNL: 'BNL',
            BNPParibasFortis: 'BNP Paribas Fortis',
            CIBCorporateandInstitutionalBanking: 'CIB – Corporate and Institutional Banking',
            Other:optionOther
        }
      }
    ]).then((result) => {
      var customFields = {'bnpp_country':result.value[0],'bnpp_entity':result.value[1]}
      var urlAPI = '/tma_apps/tma_api/v0/CustomFieldView/'
      console.log(customFields)
      $.ajax({
				url: urlAPI,
				type: "POST",
				data: customFields,
				headers: {'X-CSRFToken': $.cookie('csrftoken')},
				dataType: 'json'
			})
      .then(response => {
        Swal.fire({
          title: updateCompleted, 
          text: '', 
          icon: 'success',
          confirmButtonColor: '#9BE7D8'
        })
      })
      .catch(error => {
        Swal.showValidationMessage(
          'Request failed: '+error
        )
      })
    })
  });
</script>
<style>
  .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step, .swal2-progress-steps .swal2-progress-step, .swal2-progress-steps .swal2-progress-step-line {
    background: #9BE7D8;
  }
  .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line, .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line {
    background: rgb(173 216 230 / 0.5);
  }
  .swal2-styled{
    color: black !important;
    text-shadow: none;
    font-weight: 600;
  }
</style>
% endif

<%block name="js_extra">
  <script src="${static.url('js/commerce/credit.js')}"></script>
  <%static:js group='dashboard'/>
  <script type="text/javascript">
    $(document).ready(function() {
      edx.dashboard.legacy.init({
        dashboard: "${reverse('dashboard') | n, js_escaped_string}",
        signInUser: "${reverse('signin_user') | n, js_escaped_string}",
        changeEmailSettings: "${reverse('change_email_settings') | n, js_escaped_string}"
      });
    });
  </script>
  % if settings.FEATURES.get('ENABLE_DASHBOARD_SEARCH'):
    <%static:require_module module_name="js/search/dashboard/dashboard_search_factory" class_name="DashboardSearchFactory">
        DashboardSearchFactory();
    </%static:require_module>
  % endif
  % if redirect_message:
    <%static:require_module module_name="js/views/message_banner" class_name="MessageBannerView">
        var banner = new MessageBannerView({urgency: 'low', type: 'warning'});
        $('#content').prepend(banner.$el);
        banner.showMessage(${redirect_message | n, dump_js_escaped_json})
    </%static:require_module>
  % endif
</%block>
<link rel="stylesheet" type="text/css" href="${css_bis}" />
<div class="dashboard-notifications" tabindex="-1">
    %if message:
        <div class="dashboard-banner">
            ${message | n, decode.utf8}
        </div>
    %endif

    %if enrollment_message:
        <div class="dashboard-banner">
            ${enrollment_message | n,  decode.utf8}
        </div>
    %endif
</div>
<!-- CSS DEV -->
<!-- CSS DEV -->
<!--
<link rel="stylesheet" type="text/css" href="/media/css/dashboard.css">
-->
<link rel="stylesheet" type="text/css" href="${css}" />

<!-- DASHBOARD MONO -->
<!-- DASHBOARD MONO -->
<!-- DASHBOARD MONO -->
<!-- DASHBOARD MONO -->

<div id="voile"></div>
<div class="content_tma">
  <!-- profil -->
  <div id="dashboard_profile">
  <div id="profile_button">p r o f i l </div>
    <!-- image profil -->

<%
profile_image_url = get_profile_image_urls_for_user(user)['large']
get_persisted = ''
is_passed = False
course = ''
score = ''
course_module = ''
course_details = ''
blocks = ''
root = ''
children = ''
course_mono_id = ''
forum_tma = ''
course_finished = 0
course_name = []
for dashboard_index, enrollment in enumerate(course_enrollments):
  course = get_course_by_id(enrollment.course_id)
  if len(course_enrollments) == 1:
    course_tma = str(enrollment.course_id)
    user_tma = user.id
    #forum_tma = get_section_list(request,course_tma,user_tma)
    forum_tma= false
    course_mono_id = enrollment.course_id
    course_module = modulestore().get_course(enrollment.course_id, depth=0)
    course_details = course_module._field_data_cache['grading_policy']['GRADER']
  """
  elif len(course_enrollments) > 1:
    get_persisted = CourseGradeFactory().get_persisted(request.user, course)
    if get_persisted is None:
      get_persisted = CourseGradeFactory().create(request.user, course)
    if get_persisted.passed:
      course_finished = course_finished + 1
      course_name.append(enrollment.course_overview.display_name_with_default)
    endif
  endif
  """
endfor
%>


% if request.path == '/dashboard' :
  <% 
  profile_class = 'profile_class'
  %>
% else :
  <% 
  profile_class = 'none'
  %>
% endif

    <div class="dashboard_profile ${profile_class}" id="dashboard_profile_up">
      <a href="${reverse('learner_profile', kwargs={'username': user.username})}"><img src="${profile_image_url}" /></a>
      <h3>${user.profile.name}</h3>
      <h4>${user.email}</h4>
    </div>



% if len(course_enrollments) == 1:
    <%
    for enrollment in course_enrollments:
        cours_ouv = (enrollment.course_id in show_courseware_links_for) and not (enrollment.course_id in block_courses)
    %>

    <!-- block milieu profil -->
    <div class="dashboard_profile" id="dashboard_profile_middle">
      <!-- formation validé -->
      <div id="dashboard_profile_middle_up">
        % if False:
          <img src="${static.url('images/like_couleur.svg')}" class="svg svg_passed"/><span style="margin-left:50px;">
            %if request.LANGUAGE_CODE == 'de-de' :
              Training nicht validiert
            % else :
              ${_("Training not validated")}
            % endif
          </span>
        % elif cours_ouv:
          <img src="${static.url('images/like_couleur.svg')}" class="svg not_svg_passed"/><span style="margin-left:50px;"><a href="/courses/${course_mono_id}/progress">
            %if request.LANGUAGE_CODE == 'de-de' :
              Training nicht validiert
            % else :
              ${_("Training not validated")}
            % endif
          </a>
        </span>
        % else:
          <img src="${static.url('images/like_couleur.svg')}" class="svg not_svg_passed"/><span style="margin-left:50px;">Poursuivez votre progression</span>
        % endif
      </div>
      <!-- border middle -->
      <div id="dashboard_profile_middle_middle">
      </div>
      <!-- actif forum -->
      <div id="dashboard_profile_middle_bottom">
        % if forum_tma:
          <img src="${static.url('images/chat_couleur.svg')}" class="svg svg_passed"/><span style="margin-left: 50px;">${_("You are active on the forum")}</span>
        % elif cours_ouv:
          <img src="${static.url('images/chat_couleur.svg')}" class="svg not_svg_passed"/><span style="margin-left:50px;"><a href="/courses/${course_mono_id}/discussion/forum/">
            %if request.LANGUAGE_CODE == 'de-de' :
              Poste deine erste Nachricht
            % else :
              ${_("Post your first message ! ")}
            % endif
          </a></span>
        % else:
          <img src="${static.url('images/chat_couleur.svg')}" class="svg not_svg_passed"/><span style="margin-left:50px;">
            %if request.LANGUAGE_CODE == 'de-de' :
              Poste deine erste Nachricht
            % else :
              ${_("Post your first message ! ")}
            % endif
          </span>
        % endif
      </div>
    </div>
    <!-- block bottom profil -->
    <div class="dashboard_profile" id="dashboard_profile_bottom">
      <!-- note totale -->
      <div id="dashboard_profile_bottom_up" style="display:none">
        %if request.LANGUAGE_CODE == 'de-de' :
          <span>Abschlussnote</span>
        % else :
          <span>${_("Your final grade")}</span>
        % endif
        <span id="score_tma">${score}%</span>
      </div>
  <%
  course_details_len = len(course_details)
  mark = 0
  show_tooltip = False
  #str(course_mono_id) in ["course-v1:bnpp-netexplo+Netexplo_passeport+2018_T2_passeport","course-v1:bnpp-netexplo+Netexplo_passeport_EN+2018_T2_passeport_EN","course-v1:bnpp-netexplo+12+ES","course-v1:bnpp-netexplo+13+DE"]
  %>
  % for n in course_details:
    <% 
       mark = mark + 1 
       previously_succeeded = was_previously_succeeded_on_upro_academy(user.email,str(course_mono_id),n.get('type'))
    %>
    <!-- assignement type -->
    <div class="dashboard_profile_bottom_middle">

     %if previously_succeeded:


      <img class="svg" src="${static.url('images/badge_couleur.svg')}" id="badge_${mark}"/>
	  <span 
	  %if show_tooltip:
	  class="tooltip"
	  %endif
	  
	  >${n.get('type')}
       %if n.get('weight')==0:
          (optionnel)
       %else:
          (${_('Weight')}: ${int(n.get('weight') * 100)}%)
       %endif
	  %if show_tooltip:
	    <div class="tooltiptext">${_("This quiz was validated on the previous version of the Academy. To get your certificate you will have to pass it again.")}</div>
	  %endif
      </span>
      <span id="assignment_grade_${mark}">100%</span>


     %else:

      <img class="svg" src="${static.url('images/badge_blanc.svg')}" id="badge_${mark}"/><span>${n.get('type')} (
       %if n.get('weight')==0:
          optionnel
       %else:
          ${_('Weight')}: ${int(n.get('weight') * 100)}%
       %endif

      )</span><span id="assignment_grade_${mark}">0%</span>
     %endif

    </div>
    % if mark < course_details_len:
    <!-- border middle -->
    <div class="dashboard_profile_bottom_middle_border">
    </div>
    % endif
  % endfor
  </div>

%if course.no_grade:
 <style>
  #dashboard_profile_bottom{
    visibility:hidden;
  }
 </style>
%endif


<script type="text/javascript">
grade_summary=${dump_js_escaped_json(grade_summary) | n, decode.utf8};
j=1;
for (var i = 0; i < grade_summary['section_breakdown'].length; i++){
 if(grade_summary['section_breakdown'][i].prominent){
  grade_to_show = parseInt(grade_summary['section_breakdown'][i].percent*100);
  if(grade_to_show>0){
	$("#assignment_grade_"+j.toString()).html(grade_to_show+"%");
  }
  //TODO : Improve to get the 70 from the back
  if(grade_to_show>=70){
    $("#badge_"+j.toString()).attr("src","${static.url('images/badge_couleur.svg')}");
  }
  j=j+1;
 }
}
$("#score_tma").html(grade_summary['percent']*100+" %");
</script>
% elif len(course_enrollments) > 1:
  <div class="dashboard_profile" id="profile_bottom_multi" style="display:none">
    % if course_end < 2:
        %if request.LANGUAGE_CODE == 'en':
          <h3>${course_end} course<br>completed</h3>

        %elif request.LANGUAGE_CODE == 'es-419':
          <h3>${course_end} curso<br>terminado</h3>

        %elif request.LANGUAGE_CODE == 'de-de':
          <h3>${course_end} Kurse<br>abgeschlossen</h3>

        %else:
          <h3>${course_end} cours<br>terminé</h3>
        % endif


    % else:
        %if request.LANGUAGE_CODE == 'en':
          <h3>${course_end} courses<br>completed</h3>

        %elif request.LANGUAGE_CODE == 'es-419':
          <h3>${course_end} cursos<br>terminados</h3>

        %elif request.LANGUAGE_CODE == 'de-de':
          <h3>${course_end} Kurse<br>abgeschlossen</h3>

        %else:
          <h3>${course_end} cours<br>terminés</h3>
        % endif
    % endif
    % for n in course_name:
    <div class="course_name_profile_list">
      <img src="${static.url('images/like_couleur.svg')}" class="svg svg_passed"/><span>${n}</span>
    </div>
    % endfor
  </div>
  <% report_link = '/media/microsite/bnpp-netexplo/reports/{}_BNP_ACA.xls'.format(time.strftime("%d.%m.%Y")) %>
  <div class="dashboard_profile" id="reportButton" style="display: none;">
    <a href="${report_link}"><h3>Télécharger le rapport de notes</h3></a>
  </div>
% endif
  </div>
  <div id="dashboard_course_content">
% if len(course_enrollments) == 1:
  % for dashboard_index, enrollment in enumerate(course_enrollments):
    <% show_courseware_link = (enrollment.course_id in show_courseware_links_for) %>
    <% cert_status = cert_statuses.get(enrollment.course_id) %>
    <% can_unenroll = (not cert_status) or cert_status.get('can_unenroll') %>
    <% credit_status = credit_statuses.get(enrollment.course_id) %>
    <% show_email_settings = (enrollment.course_id in show_email_settings_for) %>
    <% course_mode_info = all_course_modes.get(enrollment.course_id) %>
    <% show_refund_option = (enrollment.course_id in show_refund_option_for) %>
    <% is_paid_course = (enrollment.course_id in enrolled_courses_either_paid) %>
    <% is_course_blocked = (enrollment.course_id in block_courses) %>
    <% course_verification_status = verification_status_by_course.get(enrollment.course_id, {}) %>
    <% course_requirements = courses_requirements_not_met.get(enrollment.course_id) %>
    <% related_programs = programs_by_run.get(unicode(enrollment.course_id)) %>
    <%include file='dashboard/_dashboard_course_listing_mono.html' args='course_overview=enrollment.course_overview, enrollment=enrollment, show_courseware_link=show_courseware_link, cert_status=cert_status, can_unenroll=can_unenroll, credit_status=credit_status, show_email_settings=show_email_settings, course_mode_info=course_mode_info, show_refund_option=show_refund_option, is_paid_course=is_paid_course, is_course_blocked=is_course_blocked, verification_status=course_verification_status, course_requirements=course_requirements, social_url=social_url,dashboard_index=dashboard_index, share_settings=share_settings, user=user, related_programs=related_programs, display_course_modes_on_dashboard=display_course_modes_on_dashboard' />
  % endfor
  </div>
  <div id="dashboard_course_info">
    <div id="dashboard_course_info_header">
      <h2>${_('News')}</h2>
    </div>
    <div>
  ${HTML(get_course_info_section(request, request.user, course, 'updates'))}
    </div>
    <span id="course_info_next"><a href="/courses/${course_mono_id}/info">${_("More news")}</a></span>
  </div>
  <!-- FIN DASHBOARD MONO -->
  <!-- FIN DASHBOARD MONO -->
  <!-- FIN DASHBOARD MONO -->
  <!-- FIN DASHBOARD MONO -->
  <!-- DASHBOARD MULTI -->
  <!-- DASHBOARD MULTI -->
  <!-- DASHBOARD MULTI -->
  <!-- DASHBOARD MULTI -->
% elif len(course_enrollments) > 1:
<style>
#tma_background_font {
  background-image: url(/media/microsite/netexplo/fond.png);
}
#dashboard_course_content {
  width: calc(100% - 470px);
  margin-left: 53px;
  margin-right: 53px;
}
</style>
<span id="list_multi_title">
  %if request.LANGUAGE_CODE == 'en':
    <h1><span id="span_1">My courses</span></h1>

  %elif request.LANGUAGE_CODE == 'es-419':
  <h1><span id="span_1">Mis cursos</span></h1>

  %elif request.LANGUAGE_CODE == 'de-de':
  <h1><span id="span_1">Meine kurse</span></h1>

  %else:
  <h1><span id="span_1">Mes formations</span></h1>
  % endif
</span>
<ul id="list_multi">



% for dashboard_index, enrollment in enumerate(course_enrollments):
  <%include file='dashboard/_dashboard_course_cell_multi.html' args='show_courseware_link = (enrollment.course_id in show_courseware_links_for),is_course_blocked = (enrollment.course_id in block_courses),course_overview=enrollment.course_overview,org_static=org_static, show_email_settings = (enrollment.course_id in show_email_settings_for), enrollment=enrollment, dashboard_index=dashboard_index' />
% endfor
</ul>
<!-- multi site css -->
<style>
.dashboard_profile {
  margin-bottom: 20px;
}
@media(max-width:1024px) {
  #dashboard_course_content {
    width: calc(100% - 76px);
    margin-left: 23px;
  }
}
@media(max-width:673px) {
  .course_show_tma {
    left: calc(100% - 120px);
    bottom: -48px;
    transform: none;
  }
  .tma_bottom_course_listing_multi {
    position: relative;
    bottom: 0;
    border-bottom-left-radius: 15px;
    border-bottom-right-radius: 0px;
  }
}
@media(max-width:445px) {
  #dashboard_course_content {
    width: calc(100% - 14px);
    margin-left: 7px;
    margin-right: 7px;
  }
}
</style>
% else:
<style>
.empty-dashboard-message a:hover{
  color: #fff !important;
}
</style>
  <div class="empty-dashboard-message">
    <p>${_("You are not enrolled in any courses yet.")}</p>

    % if settings.FEATURES.get('COURSES_ARE_BROWSABLE'):
      <a href="${marketing_link('COURSES')}">
        ${_("Explore courses")}
      </a>

    %endif
</div>
% endif
<!-- FIN DASHBOARD MULTI -->
<!-- FIN DASHBOARD MULTI -->
<!-- FIN DASHBOARD MULTI -->
<!-- FIN DASHBOARD MULTI -->
</div>
<span style="display:block;clear:left;"></span>
<script>
// SVG ACTION
jQuery('img.svg').each(function(){
    var $img = jQuery(this);
    var imgID = $img.attr('id');
    var imgClass = $img.attr('class');
    var imgURL = $img.attr('src');
    jQuery.get(imgURL, function(data) {
        // Get the SVG tag, ignore the rest
        var $svg = jQuery(data).find('svg');
        // Add replaced image's ID to the new SVG
        if(typeof imgID !== 'undefined') {
            $svg = $svg.attr('id', imgID);
        }
        // Add replaced image's classes to the new SVG
        if(typeof imgClass !== 'undefined') {
            $svg = $svg.attr('class', imgClass+' replaced-svg');
        }
        // Remove any invalid XML tags as per http://validator.w3.org
        $svg = $svg.removeAttr('xmlns:a');
        // Replace image with new SVG
        $img.replaceWith($svg);
    }, 'xml');
});
$('img.svg').show();
// NEW ACTION
$('.updates-article').each(function(){
  var This = $(this);
  var div = '<button class="check_more">${_('View more')}</button>';
  This.append(div);
})
$('#dashboard_profile_middle_up').find('path').initialize(function(){
  $(this).attr('style','');
})
$('.course_name_profile_list').find('path').initialize(function(){
  $(this).attr('style','');
})
function lineHeight(){
  $('.course_name_profile_list').find('span').each(function(){
    $(this).css('line-height','41px');
    var height = $(this).height();
    var lineHeight = parseInt(height) / 41;
    lineHeight = 41 / lineHeight;
    $(this).css('line-height',lineHeight+'px');
    console.log(lineHeight);
  })
}
$('#profile_button').click(function(){
  var num_cours = parseInt('${len(course_enrollments)}');
  var h = $('#dashboard_profile').height();
  var left = $('#dashboard_profile').css('height');
  left = parseInt(left);
  if(left == 30) {
    if(num_cours == 1) {
      var num_l = 40 * $('.dashboard_profile_bottom_middle').length;
      var height = 485+num_l;
      $('#dashboard_profile').animate({"height": height},1300);
    }else{
      $('#dashboard_profile').animate({"height": '400'},1300);
    }
  }else{
    $('#dashboard_profile').animate({"height": '30'},1300);
  }
})
$('.course_cell').click(function(){
  var url = $(this).find('a').attr('href');
  window.open(url,'_self');
})
function title_border_multi() {
  var height = parseInt($('#span_1').width()) * 0.9;
  $('#span_2').css('width',height+'px');
  $('#list_multi').find('.course-title').each(function(){
    var height = parseInt($(this).height()) / 2;
    $(this).attr('style','');
    $(this).css('margin-top','-'+height+'px');
  })
  $('#border_tma_date').attr('style','');
  var tma_date_h = parseInt($('#tma_date').height());
  if(tma_date_h > 20) {
    $('#border_tma_date').hide();
  }

}
function alignH2(){
  var width = $(document).width();
  if(width > 732) {
    $('.multi_course_title').find('h2').each(function(){
      $(this).attr('style','');
      var height = $(this).height();
      height = height / 2;
      $(this).css('margin-top','-'+height+'px');
    })
  }else{
      $(this).find('h2').attr('style','');
  }
}
/* unenroll */

function multi_unenroll() {
  $('.unenroll_multi').click(function(e){
    e.preventDefault();
    var This = $(this);
    var course_id = This.data('course-id');
    $('#unenroll_course_id').attr('value',course_id);
  })
}
$(document).ready(function(){
  lineHeight();
  title_border_multi();
  alignH2();
  multi_unenroll();
  //puceParam();
})
$(window).initialize(function(){
  lineHeight();
  title_border_multi();
  alignH2();
})

</script>
<div id="email-settings-modal" class="modal" aria-hidden="true">
  <div class="inner-wrapper" role="dialog" aria-labelledby="email-settings-title">
    <button class="close-modal">
      <span class="icon fa fa-remove" aria-hidden="true"></span>
      <span class="sr">
        ## Translators: this is a control to allow users to exit out of this modal interface (a menu or piece of UI that takes the full focus of the screen)
        ${_("Close")}
      </span>
    </button>

    <header>
      <h2 id="email-settings-title">
        ${Text(_("Email Settings for {course_number}")).format(course_number=HTML('<span id="email_settings_course_number"></span>'))}
        <span class="sr">,
          ## Translators: this text gives status on if the modal interface (a menu or piece of UI that takes the full focus of the screen) is open or not
          ${_("window open")}
        </span>
      </h2>
      <hr/>
    </header>

    <form id="email_settings_form" method="post">
      <input name="course_id" id="email_settings_course_id" type="hidden" />
      <label>${_("Receive course emails")} <input type="checkbox" id="receive_emails" name="receive_emails" /></label>
      <div class="submit">
        <input type="submit" id="submit" value="${_("Save Settings")}" />
      </div>
    </form>
  </div>
</div>

<div id="unenroll-modal" class="modal unenroll-modal" aria-hidden="true">
  <div class="inner-wrapper" role="dialog" aria-labelledby="unenrollment-modal-title">
    <button class="close-modal">
      <span class="icon fa fa-remove" aria-hidden="true"></span>
      <span class="sr">
        ## Translators: this is a control to allow users to exit out of this modal interface (a menu or piece of UI that takes the full focus of the screen)
        ${_("Close")}
      </span>
    </button>

    <header>
      <h2 id="unenrollment-modal-title">
        <span id='track-info'></span>
        <span id='refund-info'></span>
        <span class="sr">,
          ## Translators: this text gives status on if the modal interface (a menu or piece of UI that takes the full focus of the screen) is open or not
          ${_("window open")}
        </span>
      </h2>
      <hr/>
    </header>
    <div id="unenroll_error" class="modal-form-error"></div>
    <form id="unenroll_form" method="post" data-remote="true" action="${reverse('change_enrollment')}">
      <input name="course_id" id="unenroll_course_id" type="hidden" />
      <input name="enrollment_action" type="hidden" value="unenroll" />
      <div class="submit">
        <input name="submit" type="submit" value="${_("Unenroll")}" />
      </div>
    </form>
  </div>
</div>
<style>
  #dashboard_profile_middle_up .not_svg_passed path {
    fill : #FF5000!important;
  }
  #dashboard_profile_middle_bottom > #Capa_1 > g > path{
    fill : #FF5000!important;
  }
  #course_nav .svg path {
    fill: #FF5000;
  }
  #course_nav a:hover {
    border-bottom-color: #FF5000!important;
  }
  #dashboard_profile_up h3, #dashboard_profile_up h4 {
    color: #000!important;
  }
  #title_dashboard_course h1 {
    color: #000;
  }
  #course_start span, .course_nav span {
    color: #000;
  }
  #list_multi_title h1 span:last-child {
    color: #000!important;
  }
  .multi_course_title h2 a, .multi_course_title h2 a:hover, .multi_course_title h2 a:focus {
    color: #000 !important;
  }
  .down_cell {
    background-color: #9BE7D8;
  }
  .dashboard_button a {
    background-color:rgb(180, 232, 222);
    transition: all 0.1s linear 0s;
  }
  .dashboard_button a:hover {
    border: 1px solid #FF5000;
    color:black!important;
    box-sizing: border-box;
    transition: all 0.1s linear 0s;
  }

  #title_dashboard_course h1{
    background-color: #fff !important;
  }
  #course_nav a {
    background-color: white !important;
  }

  .none{
    background-color: #fff !important;
  }

  #profile_bottom_multi h3 {
    background-color:#9be7d8
  }

  #reportButton > a > h3{
    background-color: #9be7d8;
    transition: all 0.1s linear 0s;
    margin-left: 0;
    margin-right: 0;
    padding-left: 35px;
    padding-right: 35px;
    color: #636363 !important;
    font-size: 29px;
    text-transform: uppercase;
    padding: 35px;
    text-align: center;
    font-weight: 100;
  }

  #reportButton > a > h3:hover{
    background-color: #c8e4df;
    transition: all 0.1s linear 0s;
    margin-left: 0;
    margin-right: 0;
  }

  #reportButton > a{
    color: #636363 !important;
    text-decoration: none;
  }

 </style>
