<%page expression_filter="h"/>
<%inherit file="main.html" />
<%namespace name='static' file='static_content.html'/>
<%!
from django.utils.translation import ugettext as _
from django.core.urlresolvers import reverse
from openedx.core.djangoapps.site_configuration import helpers as configuration_helpers
from openedx.core.djangolib.markup import HTML, Text
primary_color=configuration_helpers.get_value("primary_color")
%>
<%
register_course_id = static.get_value('course_id')
org = static.get_value('domain_prefix')
css = '/media/microsite/{}/auto/css/index.css'.format(org)
%>
<link rel="stylesheet" type="text/css" href="${static.url(css)}" />
<style>
#global-navigation {
  display: none;
}


#temp-home {
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  width: 100%;
  height: calc(100vh - 56px);
}

#temp-home::after {
  content: "";
  background-image:url("/media/microsite/digimapper/auto/images/bg_img.jpg") !important;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  opacity: 0.85;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  position: absolute;
  z-index: -1;

}

.logo-block {
  height: 400px;
  width:800px;
  background-color: rgba(226, 228, 225, 0.7);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border-radius: 10px;
}

.logo-block > img {
  height: 140px;
}

.home-button{
  margin-top: 30px !important;
  padding: 15px 40px !important;
  border-radius: 6px !important;
  color:white !important;
  background-image: none !important;
  text-shadow:none;
  -webkit-box-shadow: 3px 3px 5px 3px rgba(50, 50, 50,0.2);
  -moz-box-shadow: 3px 3px 5px 3px rgba(50, 50, 50, 0.2);
  box-shadow: 3px 3px 5px 3px rgba(50, 50, 50, 0.2);
  background-color: ${primary_color} !important;
  border: 1px solid ${primary_color} !important;
  transition: color 0.25s ease-in-out,background 0.25s ease-in-out,box-shadow 0.25s ease-in-out;
}

footer.global{
  background-color:#80CFF5!important;
} 

#login-sso-butn {
border-image:none !important;
background-color:transparent !important;
box-shadow:none !important;
color:black !important;
font-size:14px;
}
#login-sso-butn:hover {
background-color: #15A6ED !important;
}

.home-button:hover{
  background-image: none!important;
  text-shadow:none;
  background-color: #15A6ED !important;
  -webkit-box-shadow: 3px 3px 5px 3px rgba(50, 50, 50,0.7);
  -moz-box-shadow: 3px 3px 5px 3px rgba(50, 50, 50, 0.7);
  box-shadow: 3px 3px 5px 3px rgba(50, 50, 50, 0.7);
}

.home-button:focus,.home-button:focus-within, .home-button:active  {
  outline:none;
  background-image: none!important;
  text-shadow:none;
  -webkit-box-shadow: 3px 3px 5px 3px rgba(50, 50, 50,0.2);
  -moz-box-shadow: 3px 3px 5px 3px rgba(50, 50, 50, 0.2);
  box-shadow: 3px 3px 5px 3px rgba(50, 50, 50, 0.2);
}

.home-button:disabled {
  opacity: 1 !important;
}
#connect-popin-veil, #register-popin-veil {
  display: none;
  position: absolute;
  top: 0px;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0,0,0,0.5);
}
#connect-popin-groups-container{
  max-width: 750px;
  margin: auto;
  margin-top: 20vh;
  background-color: rgba(255,255,255,0.7);
  padding: 25px;
  border-radius: 15px;
}
#connect-popin-groups-container>#wrapper-img-popup>button>img{
  width: 200px;
}
#connect-popin-groups-container>#wrapper-img-popup>button{
  width: 30%;
  text-align: center;
  padding: 0px!important;
  height : 150px;
  margin: 0 auto;
}
#connect-popin-groups-container>h2{
  text-align: center;
  color: black;
  font-weight: 600;
}
#wrapper-img-popup{
  display: flex;
  justify-items: center;
}
@media screen and (max-width: 800px) {
  #connect-popin-groups-container>#wrapper-img-popup>button {
    display:block;
    width: 220px;
    margin-bottom: 15px;
  }
  #wrapper-img-popup {
    display: block;
  }
}
/* Pop up register FR/EN */
#register-popin-veil{
display: none;
    position: absolute;
    top: 0px;
    left:0px;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0,0,0,0.5);
  }
#register-popin-groups-container{
    max-width: 750px;
    min-height: 240px;
    margin: auto;
    margin-top: 20vh;
    background-color: rgba(255,255,255,0.9);
    padding: 25px;
    border-radius: 15px;
}
#register-popin-groups-container>#wrapper-img-popup>img{
    width: 30%;
    text-align: center;
    padding: 0px!important;
    margin: 0 auto;
    width: 200px;
}
#register-popin-groups-container>#wrapper-img-popup>img:hover{
    cursor: pointer;
}
#register-popin-groups-container>h2{
    text-align: center;
    color: black;
    font-weight: 600;
}
.veilCloseContainer {
    position: absolute;
    padding-left: 15px;
}
.veilCloseContainer > img {
    width: 30px;
    position: absolute;
    right: 0;
}
.veilCloseContainer > img:hover {
    cursor: pointer;
}
#wrapper-img-popup{
    display: flex;
    justify-items: center;
}
@media screen and (max-width: 800px) {
    #register-popin-groups-container>#wrapper-img-popup>img {
      display:block;
      width: 220px;
      margin-bottom: 15px;
      display: block;
    }
}

@media screen and (max-width: 670px) {
    #logoData4Manager {
        margin-left: 10px;
    }
    #logoData4Manager > img {
        position: relative;
    }
}
@media screen and (max-width: 500px) {
    .header-global h1.logo img.ec-logo-size {
        min-width: 90vw;
    }
}
</style>
<main id="temp-home" aria-label="Content" tabindex="-1">
  <div class="logo-block">
    <img src="/media/microsite/digimapper/auto/images/transparent-logo.png" alt="digimapper logo" />
    <div>
      <button class="home-button" id="register-butn" style="text-transform:none; display: inline-block;" >
        Inscription 
      </button>
      <button class="home-button" id="login-butn" style="text-transform:none; display: inline-block;" >
        Connexion
      </button>
    </div>
    <button class="home-button" id="login-sso-butn" style="text-transform:none" >
      Pour les collaborateurs qui doivent utiliser leurs identifiants, merci de suivre ce lien
    </button>
  </div>
</main>
<div id="register-popin-veil">
  <div id="register-popin-groups-container">
    <div class="veilCloseContainer">
      <img src="/media/microsite/digimapper/images/close.png" alt="close button" onclick='closeFlags()'>
    </div>
    <h2>Veuillez sélectionner votre langue<br />Please choose your language</h2>
    <div id="wrapper-img-popup">
      <img class="register-img" src="/media/microsite/digimapper/images/fr.png" alt="drapeau fr" onclick="setFrLang()">
      <img class="register-img" src="/media/microsite/digimapper/images/uk.png" alt="drapeau en" onclick="setEnLang()">
    </div>
  </div>
</div>
<div id="connect-popin-veil">
  <div id="connect-popin-groups-container">
    <div class="veilCloseContainer">
      <img src="/media/microsite/digimapper/images/close.png" alt="close button" onclick='closeLogin()'>
    </div>
    <h2>Veuillez sélectionner l'organisme auquel vous appartenez<br />Please choose your company</h2>
    <div id="wrapper-img-popup">
    <button id="saint-gobain" onclick='window.location.href="https://www.netexplodigimapper.com/auth/login/tpa-saml/?auth_entry=register&next=%2Ftma_apps%2Fuser_info&idp=saint-gobain"'>
      <img class="connect-img" src="/media/microsite/digimapper/auto/images/logo_saint-gobain.png" alt="logo Saint-Gobain">
    </button>
    <button id="transition-optical" onclick="window.location.href='https://www.netexplodigimapper.com/auth/login/tpa-saml/?auth_entry=register&next=%2Ftma_apps%2Fuser_info&idp=to-prod'">
      <img class="connect-img" src="/media/microsite/digimapper/auto/images/logo_transitions.jpg" alt="logo Transitions-Optical">
    </button>
    <button id="safran" onclick="window.location.href='https://www.netexplodigimapper.com/auth/login/tpa-saml/?auth_entry=register&next=%2Ftma_apps%2Fuser_info&idp=safran-prod'">
      <img class="connect-img" src="/media/microsite/digimapper/auto/images/logo_safran.jpg" alt="logo Safran">
    </button>
  </div>
  </div>
</div>

<% languages = static.get_released_languages() %>
 <div class="primary nav-item active">
   <form action="/i18n/setlang/" method="post" class="settings-language-form" id="language-settings-form">
     <input type="hidden" id="csrf_token" name="csrfmiddlewaretoken" value="${csrf_token}">
     % if user.is_authenticated():
     <input title="preference api" type="hidden" class="url-endpoint" value="${reverse('preferences_api', kwargs={'username': user.username})}" data-user-is-authenticated="true">
     % else:
     <input title="session update url" type="hidden" class="url-endpoint" value="${reverse('session_language')}" data-user-is-authenticated="false">
     % endif
       <!--LANGUAGE FLAGS-->
       <div id="lang-content">
         <select class="input select language-selector" id="settings-language-value" name="language" size="2" style="display: none;">
           % for language in languages:
            <script>console.log("${language[0]}")</script>
            % if language[0] =="en" or language[0] =="fr":
             % if language[0] == LANGUAGE_CODE:
               <option value="${language[0]}" selected="selected">${language[0]}</option>
             % else:
               <option value="${language[0]}">${language[0]}</option>
             % endif
            % endif
           % endfor
         </select>
       </div>
     </label>
   </form>
 </div>

<script>
  //LANGUAGE FLAGS
  var setEnLang = function() {
    var url = '/register?course_id=course-v1:digimapper+level1+EN&enrollment_action=enroll'
    if ($('#settings-language-value > option[value="fr"]').attr('selected') === 'selected') {
      var state = {}
      var title = ''
      history.pushState(state, title, url)
      $('#settings-language-value > option[value="en"]').attr('selected','selected');
      $('#settings-language-value > option[value="fr"]').removeAttr('selected').trigger( "change");
    } else {
      window.location.href=url
    }
    console.log('OK EN')
  }

  var setFrLang =  function() {
    var url = '/register?course_id=course-v1:digimapper+level1+FR&enrollment_action=enroll'
    if ($('#settings-language-value > option[value="en"]').attr('selected') === 'selected') {
      var state = {}
      var title = ''
      history.pushState(state, title, url)
      $('#settings-language-value > option[value="fr"]').attr('selected','selected');
      $('#settings-language-value > option[value="en"]').removeAttr('selected').trigger( "change");
    } else {
      window.location.href=url
    }
    console.log('OK FR')
  }

function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, '\\$&');
    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

$("#login-butn").click(function(){
  window.location.href="/login?admin=true";
});

$("#login-sso-butn").click(function(){
  if(getParameterByName("company")=="to"){
    window.location.href="https://www.netexplodigimapper.com/auth/login/tpa-saml/?auth_entry=register&next=%2Ftma_apps%2Fuser_info&idp=to-prod";
  }else if(getParameterByName("company")=="safran"){
    window.location.href="https://www.netexplodigimapper.com/auth/login/tpa-saml/?auth_entry=register&next=%2Ftma_apps%2Fuser_info&idp=safran-prod";
  }else if(getParameterByName("company")=="saintgobain"){
    window.location.href="https://www.netexplodigimapper.com/auth/login/tpa-saml/?auth_entry=register&next=%2Ftma_apps%2Fuser_info&idp=saint-gobain";
  }else{
    $("#connect-popin-veil").show();
  }
  closeLogin = function(){
    $("#connect-popin-veil").hide();
  }
});

$("#register-butn").click(function(){
    $("#register-popin-veil").show();
  });
  closeFlags = function(){
    $("#register-popin-veil").hide();
  }
</script>
