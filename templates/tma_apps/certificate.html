<%page expression_filter="h"/>
<%inherit file="/main.html" />
<%namespace name='static' file='/static_content.html'/>
<%def name="online_help_token()"><% return "courseware" %></%def>
<%!
from django.utils.translation import ugettext as _
from django.conf import settings
from edxnotes.helpers import is_feature_enabled as is_edxnotes_enabled
from openedx.core.djangolib.markup import HTML
from openedx.core.djangolib.js_utils import js_escaped_string, dump_js_escaped_json
from openedx.core.djangoapps.site_configuration import helpers as configuration_helpers
from datetime import datetime, date
import json
from tma_apps.tma_support_functions import tma_verify_access

primary_color = configuration_helpers.get_value('primary_color')
background_image = '/media/microsite/hedis/auto/images/bg_img_cert.jpg'

%>

<%

users_for_validation = [
  "paul.theveniau@gama29.fr",
  "testhedis0001@yopmail.com",
  "celine.joliduc@sa-bhe.fr",
  "emmanuelle.rouet@sa-bhe.fr",
  "chloe.martins@sa-bhe.fr",
  "a.joly@groupe-hedis.com",
  "s.ben-daoud@groupe-hedis.com",
  "weup2102@yopmail.com",
  "r.peuze@comptoir-de-bretagne.com",
  "x.inguimbert@sas-blanc.com",
  "w.banse@daugeron.fr",
  "n.dornier@groupe-hedis.com",
  "didier.lemaire@gama29.fr",
  "s.gimenez@sas-blanc.com",
  "v.bertin@sas-blanc.com",
  "e.janssen@sas-blanc.com",
  "cedric.lussat@sa-aed.fr",
  "philippe.mauboussin@gama29.fr",
  "laurence.marcou@fichot-hygiene.fr",
  "dircom@nicolasentretien.com",
  "d.tourret@daugeron.fr",
  "service-achats@icahygiene.com",
  "j.siefert@sas-blanc.com",
  "t.mercier@sas-blanc.com",
  "n.monnier@daugeron.fr",
  "c.menon@sas-blanc.com",
  "veronique.goulet@gama29.fr",
  "thibaut.jousset@fichot-hygiene.fr",
  "olivier.batelier@nicolasentretien.com",
  "caroline.leroux@gama29.fr",
  "f.molines@sas-blanc.com",
  "jean.pacheco@nicolasentretien.com",
  "aurelie.pichon@gama29.fr",
  "anne-sophie.landrevie@gama29.fr",
  "netexplotest12@yopmail.com",
  "dimitri.hoareau@themoocagency.com",
  "testcertificatehedis@yopmail.com",
  "philippe.mauboussin@gama29.fr",
  "sebastien.lopvet@sa-aed.fr",
  "franck.clement@fichot-hygiene.fr",
  "aurore.herve@gama29.fr",
  "anthony.turpin@fichot-hygiene.fr",
  "sandy.ribaud@sa-bhe.fr",
  "j.dizy@sas-blanc.com",
  "s.cassin@sas-blanc.com",
  "gregory.castro@sa-bhe.fr",
  "fabrice.oger@gama29.fr",
  "sylvain.letort@gama29.fr",
  "ravalettony@gmail.com",
  "antoine.roubert28@gmail.com",
  "gilles.spring@sa-bhe.fr",
  "p.jamma@sas-blanc.com",
  "b.dupouy@sopecal-hygiene.com",
  "r.lobstein@sas-blanc.com",
  "jean-yves.moyou@gama29.fr",
  "jessica@nicolasentretien.com",
  "f.payot@orru.fr",
  "audrey.barranco@sa-aed.fr",
  "c.decorte@daugeron.fr",
  "ludovic@nicolasentretien.com",
  "christophecosta@nicolasentretien.com",
  "tom_espinha@outlook.fr",
  "l.godest@groupe-hedis.com",
  "j.perrin@orru.fr",
  "antony@nicolasentretien.com",
  "adelina.chopard@fichot-hygiene.fr",
  "aurelie.pichon@gama29.fr",
  "claire.lannuzel@gama29.fr",
  "s.lacoux@sas-blanc.com",
  "bardes_corentin@hotmail.fr",
  "cyril.dechannes@sa-bhe.fr",
  "k.nousse@sas-blanc.com",
  "p.mas@sopecal-hygiene.com",
  "alexis.asen@fichot-hygiene.fr",
  "hugo.liard@sa-bhe.fr",
  "adrien.havard@sa-bhe.fr",
  "o.saudicoeur@orru.fr",
  "d.schmitt@orru.fr",
  "fernandes.vincent@hotmail.fr",
  "d.dacosta@orru.fr",
  "tom.espina@sa-bhe.fr",
  "jeff@nicolasentretien.com",
  "antho.collot@gmail.com",
  "pascal@nicolasentretien.com",
  "angelique.hermeline@fichot-hygiene.fr",
  "cyrilos69@gmail.com",
  "tom.douce@themoocagency.com",
  "x.inguimbert@sas-blanc.com",
  "thibaut.jousset@fichot-hygiene.fr",
  "frank.gorge@gama29.fr",
  "aurore.richomme@gama29.fr",
  "valerie.echard@fichot-hygiene.fr",
  "c.rodriguez@sas-blanc.com",
  "lionel.marillaud@gama29.fr",
  "s.choux@sas-blanc.com",
  "g.castan@sas-blanc.com",
  "charlene.petiot@sa-bhe.fr",
  "M.TASSI@SAS-BLANC.COM",
  "sav@fichot-hygiene.fr",
  "r.garcia@sas-blanc.com",
  "f.abelan@sas-blanc.com",
  "theo.chauveau@fichot-hygiene.fr",
  "a.lavielle@orru.fr",
  "jacques.dabouzi@nicolasentretien.com",
  "s.soto@sas-blanc.com",
  "r.vaillier@sas-blanc.com",
  "b.morel@groupe-hedis.com",
  "m.payot@orru.fr",
  "n.autenzio@orru.fr",
  "g.bidos@orru.fr",
  "a.payet@orru.fr",
  "m.lopez@sopecal-hygiene.com",
  "c.barthelot@orru.fr",
  "romain.bonnefoy@sa-bhe.fr",
  "gael.lejuez@sfr.fr",
  "valerie.calone@orru.fr",
  "s.ayme@orru.fr",
  "j.pascual@orru.fr",
  "m.laugier@orru.fr",
  "fabrice.delattre3@gmail.com",
  "s.martin@sopecal-hygiene.com",
  "i.rosso@orru.fr",
  "thierrybonnefoy@sfr.fr",
  "f.calendini@orru.fr",
  "ludovic.meynard@nicolasentretien.com",
  "k.manca@sas-blanc.com",
  "s.delande@sas-blanc.com",
  "totom0300@hotmail.fr",
  "cedric.decosne@orange.fr",
  "alexandre.berteau@themoocagency.com"
]


%>


<%block name="pagetitle">${_("Certificat de reussite")}</%block>

<!-- COMMON STYLE-->
<style>
  h1,h2,h3,h4,h5,p{
    font-family:  inherit ;
    color: #0C4D84 !important;
  }
  p{
    padding:10px ;
    font-size: 1.2rem;
  }
  h4{
    font-size: 1.5rem;
  }
  h3{
    font-size: 1.7rem ;
  }
  #certificate-wrapper{
    background: white;
  }
  .certificate-border{
    border:2px solid ${primary_color};
    border-radius:5px;
  }
  #custom-btn{
    background: ${primary_color};
    border: none;
    box-shadow: none;
    text-shadow: none;
  }
  #internal-border{
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-direction: column;
    text-align: center;
    padding: 20px;
    box-sizing: border-box;
  }
  #certificate-wrapper{
    min-height: calc(100vh - 133px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  #certificate-container{
    width:897px;
    height:500px;
    margin: 0 auto;
    padding: 20px;
    background-image: url("${background_image}");
    background-size: contain;
    position: relative;
  }
  #pdf-btn-wrapper{
    padding: 15px
  }
  #certificate-title{
    text-transform: uppercase;
    color: #0C4D84;
    font-weight: bold;
    margin: 43px 0 0 127px;
    font-size: 32px;
  }
  #noCertificateMessage{
    background: white;
    height: calc(100vh - 133px);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
  }
  #fullname {
    color: #F79220 !important;
    padding: 10px;
    font-weight: bold;
    text-transform: capitalize;
    font-size: 40px;
  }
  #grade {
    position: absolute;
    font-size: 18px;
    font-weight: 700;
    right: 75px;
    bottom: 84px;
    transform: rotate(7deg);
  }
  #grade > span {
    font-size: 56px;
    color: #51BCEC;
    line-height: 115px;
  
  }
  #frame {
    width: 80%;
    background-color: rgba(255,255,255,0);
    padding: 10px;
    border-radius: 10px;
    margin-top: 55px;
  }
  #line01, #line02 {
    text-align: start;
    font-weight: bold;
  }
  #course_name {
    font-size: 24px;
    font-weight: bold;
    color: #51BCEC !important;
    text-align: start;
    padding : 20px 10px;
  }
  #datetime {
    text-align: start;
    font-size: 19.2px;
    padding: 10px;
    font-weight: bold;
  }
</style>

<!-- CUSTOM STYLE -->
<style>

</style>
% if grades.get('passed') or  tma_verify_access(request.user).is_tma_team() or str(request.user.email) in users_for_validation :
<div id="certificate-wrapper">
  <div id="pdf-btn-wrapper">
    <button id="custom-btn" onclick="CertificateToPdf()">TELECHARGER PDF</button>
  </div>
  <div id="certificate-container" class=" certificate-border">
      <div id="internal-border" >
          <div id="certificate-title">Certificat de Réussite</div>
          <div id='frame'>
            <p id='line01'>L'équipe <span style="text-transform: capitalize;">
              ${configuration_helpers.get_value('course_org_filter')} 
            </span> 
            certifie que </p>
            <h3 id='fullname' >${first_name} ${last_name}</h3>
            <p id='line02' >A validé le cours :</p>
            <h4 id='course_name'>${course_name}</h4>
            % if str(request.user.email) in users_for_validation :
            <h4 id="grade" style="width: 225px;right: 26px;">
              Avec une note supérieure à <br>
              <span>
                80 %
              </span> 
            </h4>
            % else :
            <h4 id='grade' >
              Avec la note de <br>
              <span>
                ${int(grades['grade']*100)}%
              </span> 
            </h4>
            % endif 
            <h4 id='datetime'></h4>
          </div>
          <div>
          </div>
      </div>
  </div>
</div>
%else:
  <div id="noCertificateMessage">
      <h3>Certificat Non Disponible</h3>
      <p>Vous n'avez pas atteint le score minimal requis pour obtenir votre certificat.</p>
  </div>
%endif

<!-- PDF CREATOR-->
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.debug.js"></script>
<script>
  function CertificateToPdf(){
     html2canvas(document.getElementById("certificate-container"), {
      onrendered : function (canvas){
       var img=canvas.toDataURL("image/png");
       var doc = new jsPDF({orientation: 'landscape'});
       doc.addImage(img, "PNG", 30, 35);
       doc.save("certificat.pdf");
      }
    })
  }
  //AVOID INTERNET EXPLORER NOT WORKING WITH HTML2CANVAS
  $(document).ready(function(){
    if(navigator.userAgent.indexOf("Firefox")<0 && navigator.userAgent.indexOf("Chrome")<0 && navigator.userAgent.indexOf("Safari")<0){
    $('#pdf-btn-wrapper').html("${_('Download PDF : This feature is not available on Internet Explorer. Please use Chrome Mozilla or Safari to get your pdf')}")
    }
  })

  // DATE
  date = new Date();
  var tab_mois=["janvier", "février", "mars", "avril", "mai", "juin", "juillet", "août", "septembre", "octobre", "novembre", "décembre"];
  var day = date.getDate();
  var monthIndex = date.getMonth();
  var year = date.getFullYear();

  document.getElementById("datetime").innerHTML = "Délivré le " + day + " " + tab_mois[monthIndex]+ " " + year;

</script>

