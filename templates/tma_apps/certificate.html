<%page expression_filter="h"/>
<%inherit file="/main.html" />
<%namespace name='static' file='/static_content.html'/>
<%def name="online_help_token()"><% return "courseware" %></%def>
<%!
from django.utils.translation import ugettext as _
from django.conf import settings
from edxnotes.helpers import is_feature_enabled as is_edxnotes_enabled
from openedx.core.djangolib.markup import HTML
from openedx.core.djangolib.js_utils import js_escaped_string, dump_js_escaped_json
from openedx.core.djangoapps.site_configuration import helpers as configuration_helpers
from datetime import datetime, date
import json

%>

<%
if request.user.email.find("weuplearning.com") != -1 :
  is_tma_team = True
else :
  is_tma_team = False

org = static.get_value('domain_prefix')
%>

<%block name="pagetitle">${_("Certificat de reussite")}</%block>

<style>
/* General */
#global-navigation,.wrapper-footer,#tma_background_font {
  display: none !important;
}
body{
  text-align:center;
}
#content{
  margin-top: 50px;
}
.container{
  /* margin-top:130px; */
  width:854px;
  height:480px;
  /* margin-left: 70px; */
  padding: 0;
}
#main {
  background-image:url('${bg}');
  background-size:cover;
  background-position:center;
}
.main-color{
  background-color: rgba(0,131,169,1);
}
.second-color{
  background-color: #4d4d4d;
}
.texte-gras{
  font-weight: 600;
}

/* Premier bandeau */
.bandeau-top p{
  font-weight: 600;
  color: white;
  margin-top: 15px;
}
.title-attestation{
  width: 80%;
  float: left;
  padding: 10px;
  box-sizing: border-box;
}
.logo-attestation{
  width: 20%;
  float: left;
  text-align: right;
  padding: 10px;
  box-sizing: border-box;
  background-color: white;
}
.logo-attestation img{
  max-height: 40px;
  width: 100%;
}

/* Deuxième bandeau */
.bandeau-middle{
  color: white;
  margin-top: 100px;
  padding: 30px 10px;
}
#course-title{
  font-size: 20px;
}
#nom-user{
  font-size: 30px;
  margin-bottom: 30px;
}
#score, #course-title{
  margin-top: 10px;
}

/* Footer */
.footer-left{
  float: left;
}
.footer-right img{
  max-height: 80px;
}
.footer-right{
  float: right;
  margin-right: 20px;
  text-align: right;
  width: 20%;
}
.footer-left{
  width: 80%;
}
.footer{
  padding: 10px;
  margin-top: 44px;
}
.footer p{
  margin-top: 74px;
  font-size: 12px;
  text-align: left;
  background-color: white;
}

/* new certificate */

#certificate-container{
  height: 100%;
  padding: 40px;
  box-sizing: border-box;
  background: white;
  background-image: url('/media/microsite/${org}/certificate/certificate.png');
  background-size: contain;
  width: 881px;
  height: 510px;
  margin: auto;
}

.certificate-border{
  border:0.5px solid rgba(0,131,169,1);
}
.name {
  color: #7872b0;
  margin-bottom: 10px;
  font-size: 1.8em;
  font-weight: 600;
}

.course {
  color: #003d58;
  margin-bottom: 10px;
  font-size: 1.4em;
  font-weight: 600;
}

.details {
  color: #003d58;
  margin-bottom: 10px;
  text-transform: uppercase;
  font-size: 1em;
  margin-top: 12px;
}

</style>


% if grades.get('passed') or is_tma_team:
  % if (request.path == '/tma_apps/course-v1:actia+SPOC+2020/certificate/render') or (request.path == '/tma_apps/course-v1:actia+SPOC+2024/certificate/render') : 

  <div id="pdf-btn-wrapper" style="margin-bottom: 30px;">
    <button style="background: #0083a9;" id="custom-btn" onclick="CertificateToPdf()">TELECHARGER PDF</button>
  </div>
  <div class="container" id="main">
    <div id="certificate-wrapper" >
      <div id="certificate-container" class=" certificate-border">
        <h2 class="name">${first_name} ${last_name}</h2>
        <h2 class="course">a suivi et réussi la formation en ligne SPOC ACTIA</h2>
        <h2 class="course">&laquo; ${course_name} &raquo;</h2>
        <h3 class="details">Durée totale de 7 heures minimum</h3>
        <h3 class="details">Note finale : <span style="margin-left: 1em;">${grades.get('grade')*100} %</span> - Attestation délivrée le ${date.today().strftime("%d %B %Y")} </h3>
      </div>
    </div>
  </div>

  % else :

    <div class="container" id="main">
      <div class="bandeau-top main-color">
        <div class="title-attestation">
          <p>ATTESTATION DE SUIVI ET DE R&Eacute;USSITE</p>
        </div>
        <div class="logo-attestation">
          <img id="certificate_logo" src="${configuration_helpers.get_value('logo_image_url')}"/>
        </div>
        <div style="clear:both;"></div>
      </div>
      <div class="bandeau-middle second-color">
        <p>ACTIA atteste que</p>
        <p id="nom-user">${first_name} ${last_name}</p>
        <p>a suivi et réussi le MOOC</p>
        <p class="texte-gras" id="course-title">${course_name} 2020</p>
        <p id="score">avec un score de ${grades.get('grade')*100}%</p>
      </div>
    </div>
    <div style='margin-top:20px;'>
      <button id="bouton-pdf" onclick="printpage()">VERSION PDF</button>
    </div>

  % endif



<script src="/media/dashboard/bootstrap/bootstrap.min.js" charset="utf-8"></script>
<script type="text/javascript"></script>
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.debug.js"></script>

<script type="text/javascript">
//PDF VERSION
function printpage(){
  html2canvas(document.getElementById('main'), {
    onrendered : function (canvas){
      var img=canvas.toDataURL("image/png");
      var doc = new jsPDF({orientation: 'landscape'});
      doc.addImage(img, "PNG", 20, 20);
      doc.save("certificat.pdf");
    }
  })
}

function CertificateToPdf(){
  html2canvas(document.getElementById("certificate-container"), {
    onrendered : function (canvas){
      var img=canvas.toDataURL("image/png");
      var doc = new jsPDF({orientation: 'landscape'});
      doc.addImage(img, "PNG", 35, 35);
      doc.save("certificat.pdf");
    }
  })
}

$(document).ready(function(){
  if(navigator.userAgent.indexOf("Firefox")<0 && navigator.userAgent.indexOf("Chrome")<0 && navigator.userAgent.indexOf("Safari")<0){
    $('#pdf-btn-wrapper').html("${_('Download PDF : This feature is not available on Internet Explorer. Please use Chrome Mozilla or Safari to get your pdf')}")
  }
})

</script>
% endif
