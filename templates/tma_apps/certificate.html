<%page expression_filter="h"/>
<%inherit file="/main.html" />
<%namespace name='static' file='/static_content.html'/>
<%def name="online_help_token()"><% return "courseware" %></%def>
<%!
from django.utils.translation import ugettext as _
from django.conf import settings
from edxnotes.helpers import is_feature_enabled as is_edxnotes_enabled
from openedx.core.djangolib.markup import HTML
from openedx.core.djangolib.js_utils import js_escaped_string, dump_js_escaped_json
from openedx.core.djangoapps.site_configuration import helpers as configuration_helpers
from datetime import datetime, date
import json
from tma_apps.tma_support_functions import tma_verify_access

primary_color = configuration_helpers.get_value('primary_color')
background_url = configuration_helpers.get_value('bg_img')
%>

<%block name="pagetitle">${_("Certificat de reussite")}</%block>

<% 
english_path = ['/tma_apps/course-v1:mooc-conservation+protected-areas+2021_T1_EN/certificate/render',
'/tma_apps/course-v1:mooc-conservation+law-enforcement+2021_T1_EN/certificate/render',
'/tma_apps/course-v1:mooc-conservation+species-conservation+2021_T1_EN/certificate/render',
'/tma_apps/course-v1:mooc-conservation+eco-monitoring+2021_T1_EN/certificate/render',
'/tma_apps/course-v1:mooc-conservation+areas-valorisation+2021_T1_EN/certificate/render',
'/tma_apps/course-v1:mooc-conservation+new-techs+2021_T1_EN/certificate/render',
'/tma_apps/course-v1:mooc-conservation+marine-areas+2021_T1_EN/certificate/render',
'/tma_apps/course-v1:mooc-conservation+essential-ranger+2021_T1_EN/certificate/render',
'/tma_apps/course-v1:mooc-conservation+essential-manager-law+2021_T1_EN/certificate/render',
'/tma_apps/course-v1:mooc-conservation+essential-manager-research+2021_T1_EN/certificate/render',
'/tma_apps/course-v1:mooc-conservation+essential-leader+2021_T1_EN/certificate/render']
%>

<!-- FONT CALL -->
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet"> 

<!-- COMMON STYLE-->
<style>
  h1,h2,h3,h4,h5,p{
    font-family: inherit;
    text-align: center;
    line-height: 0.1em;
    font-family: 'Roboto', sans-serif;
    font-size: 14.5px;
  }
  .text{
    font-weight: 300;
  }

.text-bold{
font-weight: 400;
}
.name{
  font-size: 2em;
  font-weight: 500;
  text-transform: uppercase;
  color: ${primary_color};
  margin:1.5em;
}
.text-date{
margin-top: 4em;
margin-right: 24%;
font-weight: 300;
}

#certificate-container-text{
  margin-top: 20%;
}
  #certificate-wrapper{
    background: white;
  }

  #custom-btn{
    background: #336166;
    border: none;
    box-shadow: none;
    text-shadow: none;
  }

  #certificate-wrapper{
    min-height: calc(100vh - 133px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  #certificate-container{
    width:914px;
    height:500px;
    margin: 0 auto;
    padding: 20px;
    background-size: contain;
  }
  #pdf-btn-wrapper{
    padding: 15px
  }

  #noCertificateMessage{
    background: white;
    height: calc(100vh - 133px);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
  }

  /* certificates background */
  .gestion_fr{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/background_aires_protegees.png');
  }
  .gestion_en{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/background_aires_protegees_en.png');
  }

  .suivi_fr{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/suivi.png');
  }
  .suivi_en{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/suivi_en.png');
  }

  .loi_fr{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/loi.png');
  }
  .loi_en{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/loi_en.png');
  }

  .conservation_fr{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/conservation.png');
  }
  .conservation_en{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/conservation_en.png');
  }

  .valorisation_fr{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/valorisation.png');
  }
  .valorisation_en{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/valorisation_en.png');
  }

  .techno_fr{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/techno.png');
  }
  .techno_en{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/techno_en.png');
  }

  .marine_fr{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/marine.png');
  }
  .marine_en{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/marine_en.png');
  }

  .essentiel_fr{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/essentiel.png');
  }
  .essentiel_en{
    background-image: url('/media/microsite/mooc-conservation/extra/certificat/essentiel_en.png');
  }

  .container-text-essentials{
    margin-top: 23% !important;
  }

</style>

% if grades.get('passed') or  tma_verify_access(request.user).is_tma_team():
<div id="certificate-wrapper">
  <div id="pdf-btn-wrapper">
    <button id="custom-btn" onclick="CertificateToPdf()">TELECHARGER PDF</button>
  </div>
  % if request.path == '/tma_apps/course-v1:mooc-conservation+aires-protegees+2021_T1/certificate/render' : 
    <div id="certificate-container" class="gestion_fr">
  % elif request.path == '/tma_apps/course-v1:mooc-conservation+protected-areas+2021_T1_EN/certificate/render' :
    <div id="certificate-container" class="gestion_en">
  % elif request.path == '/tma_apps/course-v1:mooc-conservation+suivi-eco+2021_T1/certificate/render' : 
    <div id="certificate-container" class="suivi_fr">
  % elif request.path == '/tma_apps/course-v1:mooc-conservation+eco-monitoring+2021_T1_EN/certificate/render' :
    <div id="certificate-container" class="suivi_en">
  % elif request.path == '/tma_apps/course-v1:mooc-conservation+application-loi+2021_T1/certificate/render' : 
    <div id="certificate-container" class="loi_fr">
  % elif request.path == '/tma_apps/course-v1:mooc-conservation+law-enforcement+2021_T1_EN/certificate/render' :
    <div id="certificate-container" class="loi_en">
  % elif request.path == '/tma_apps/course-v1:mooc-conservation+conservation-especes+2021_T1/certificate/render' : 
    <div id="certificate-container" class="conservation_fr"> 
  % elif request.path == '/tma_apps/course-v1:mooc-conservation+species-conservation+2021_T1_EN/certificate/render' :
    <div id="certificate-container" class="conservation_en">   
  % elif request.path == '/tma_apps/course-v1:mooc-conservation+valorisation-aires+2021_T1/certificate/render' : 
    <div id="certificate-container" class="valorisation_fr">
  % elif request.path == '/tma_apps/course-v1:mooc-conservation+areas-valorisation+2021_T1_EN/certificate/render' :
    <div id="certificate-container" class="valorisation_en">
  % elif request.path == '/tma_apps/course-v1:mooc-conservation+nouvelles-technologies+2021_T1/certificate/render' : 
    <div id="certificate-container" class="techno_fr">
  % elif request.path == '/tma_apps/course-v1:mooc-conservation+new-techs+2021_T1_EN/certificate/render' :
    <div id="certificate-container" class="techno_en">
  % elif request.path == '/tma_apps/course-v1:mooc-conservation+aires-marines+2021_T1/certificate/render' : 
    <div id="certificate-container" class="marine_fr">
  % elif request.path == '/tma_apps/course-v1:mooc-conservation+marine-areas+2021_T1_EN/certificate/render' :
    <div id="certificate-container" class="marine_en">
  % elif request.path == '/tma_apps/course-v1:mooc-conservation+essentiel-ranger+2021_T1/certificate/render' or request.path == '/tma_apps/course-v1:mooc-conservation+essentiel-manager-loi+2021_T1/certificate/render' or request.path == '/tma_apps/course-v1:mooc-conservation+essentiel-manager-recherche+2021_T1/certificate/render' or request.path == '/tma_apps/course-v1:mooc-conservation+essentiel-leader+2021_T1/certificate/render' : 
    <div id="certificate-container" class="essentiel_fr">
  % elif request.path == '/tma_apps/course-v1:mooc-conservation+essential-ranger+2021_T1_EN/certificate/render' or request.path == '/tma_apps/course-v1:mooc-conservation+essential-manager-law+2021_T1_EN/certificate/render' or request.path == '/tma_apps/course-v1:mooc-conservation+essential-manager-research+2021_T1_EN/certificate/render' or request.path == '/tma_apps/course-v1:mooc-conservation+essential-leader+2021_T1_EN/certificate/render' :
    <div id="certificate-container" class="essentiel_en">
  % endif  
  %if request.path == '/tma_apps/course-v1:mooc-conservation+essentiel-ranger+2021_T1/certificate/render' or request.path == '/tma_apps/course-v1:mooc-conservation+essentiel-manager-loi+2021_T1/certificate/render' or request.path == '/tma_apps/course-v1:mooc-conservation+essentiel-manager-recherche+2021_T1/certificate/render' or request.path == '/tma_apps/course-v1:mooc-conservation+essentiel-leader+2021_T1/certificate/render' or request.path == '/tma_apps/course-v1:mooc-conservation+essential-ranger+2021_T1_EN/certificate/render' or request.path == '/tma_apps/course-v1:mooc-conservation+essential-manager-law+2021_T1_EN/certificate/render' or request.path == '/tma_apps/course-v1:mooc-conservation+essential-manager-research+2021_T1_EN/certificate/render' or request.path == '/tma_apps/course-v1:mooc-conservation+essential-leader+2021_T1_EN/certificate/render' : 
      <div id="certificate-container-text" class="container-text-essentials">
  % else :
      <div id="certificate-container-text">
  % endif
  % if request.path not in english_path :
        <p class="text">Geoffroy Mauvais, coordinateur du programme</p>
        <p><span class="text-bold">Aires protégées d'Afrique & Conservation (PAPACO) del'Union internationale</span></p>
        <p><span class="text-bold">pour la conservation de la nature (UICN)</span> atteste que </p>
        <p class="name">${first_name} ${last_name}</p>
        <p class="text">a suivi l'intégralité du <span class="text-bold"> MOOC « ${course_name} »</span></p>
        <p>et a passé avec succès les examens en ligne.</p>
        <p class="text-date">Le <span class="text-date" id="dateDeCertificat"></p>
  % else :
        <p class="text">Geoffroy Mauvais, coordinator of the Program on</p>
        <p><span class="text-bold">African Protected Areas & Conservation (PAPACO) of the International Union</span></p>
        <p><span class="text-bold">for Conservation of Nature (IUCN)</span> confirms that</p>
        <p class="name">${first_name} ${last_name}</p>
        <p class="text">completed the <span class="text-bold"> course « ${course_name} »</span></p>
        <p>and successfully passed all the online exams.</p>
        <p class="text-date">${date.today().strftime("%d %B %Y") }</p>
  % endif
      </div>
    </div>
</div>

%else:
  <div id="noCertificateMessage">
      <h3>Certificat Non Disponible</h3>
      <p>Vous n'avez pas atteint le score minimal requis pour obtenir votre certificat.</p>
  </div>
%endif

<!-- PDF CREATOR-->
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.debug.js"></script>
<script>
  function CertificateToPdf(){
     html2canvas(document.getElementById("certificate-container"), {
      onrendered : function (canvas){
       var img=canvas.toDataURL("image/png");
       var doc = new jsPDF({orientation: 'landscape'});
       doc.addImage(img, "PNG", 22, 35);
       doc.save("certificat.pdf");
      }
    })
  }
  //AVOID INTERNET EXPLORER NOT WORKING WITH HTML2CANVAS
  $(document).ready(function(){
    if(navigator.userAgent.indexOf("Firefox")<0 && navigator.userAgent.indexOf("Chrome")<0 && navigator.userAgent.indexOf("Safari")<0){
    $('#pdf-btn-wrapper').html("${_('Download PDF : This feature is not available on Internet Explorer. Please use Chrome Mozilla or Safari to get your pdf')}")
    }
    // GET XCERTIFICATE DATE
    var monthNames = [
      "Janvier", "Fevrier", "Mars",
      "Avril", "Mai", "Juin", "Juillet",
      "Août", "Septembre", "Octobre",
      "Novembre", "Decembre"
    ];
    date = new Date();

    var day = date.getDate();
    var monthIndex = date.getMonth();
    var year = date.getFullYear();
    var certificate_date = day + ' ' + monthNames[monthIndex] + ' ' + year;

    $('#dateDeCertificat').text(certificate_date)
  })
  $( document ).ready(function() {
    if ($('.name').text().length >= 36) {
    $('.name').css({
      'font-size': '20px',
      'margin-bottom': '40px',
      'line-height': 1})
    }
  });
</script>

