<%page expression_filter="h"/>
<%inherit file="/main.html" />
<%namespace name='static' file='/static_content.html'/>
<%def name="online_help_token()"><% return "courseware" %></%def>
<%!
from django.utils.translation import ugettext as _
from django.conf import settings
from edxnotes.helpers import is_feature_enabled as is_edxnotes_enabled
from openedx.core.djangolib.markup import HTML
from openedx.core.djangolib.js_utils import js_escaped_string, dump_js_escaped_json
from openedx.core.djangoapps.site_configuration import helpers as configuration_helpers
from datetime import datetime, date
import json
from tma_apps.tma_support_functions import tma_verify_access

primary_color = configuration_helpers.get_value('primary_color')
background_url = configuration_helpers.get_value('bg_img')
background_image_suivi = '/media/microsite/sncf-maintenance/images/fond_certificat_suivi.png'

%>



<%block name="pagetitle">${_("Attestation de suivi")}</%block>

<!-- COMMON STYLE-->
<style>

  :root{
    --orange: #E05312;
    --blue: #1687C9;
  }
  @font-face {
    font-family: 'Avenir Heavy';
    src: url('/media/microsite/sncf-maintenance/fonts/Avenir-Heavy.eot');
    src: url('/media/microsite/sncf-maintenance/fonts/Avenir-Heavy.eot') format('embedded-opentype'),
        url('/media/microsite/sncf-maintenance/fonts/Avenir-Heavy.woff2') format('woff2'),
        url('/media/microsite/sncf-maintenance/fonts/Avenir-Heavy.woff') format('woff'),
        url('/media/microsite/sncf-maintenance/fonts/Avenir-Heavy.ttf') format('truetype'),
        url('/media/microsite/sncf-maintenance/fonts/Avenir-Heavy.svg') format('svg');
    font-weight: bold;
    font-style: normal;
    font-display: swap;
  }

  h1,h2,h3,h4,h5,p{
    font-family: inherit
  }
  p{
    padding:10px
  }
  h4{
    font-size: 1.5rem;
  }
  h3{
    font-size: 1.7rem
  }
  #certificate-wrapper{
    background: white;
  }
  .certificate-border{
    /* border:2px solid ${primary_color}; */
    /* border-radius:5px; */
    position: relative;
  }
  .certificate-border h3 {
    color: var(--orange);
    font-family: "Avenir Heavy";
  }

  #custom-btn{
    background: ${primary_color};
    border: none;
    box-shadow: none;
    text-shadow: none;
  }
  #internal-border{
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-direction: column;
    text-align: center;
    padding: 20px 30px 20px 20px;
    box-sizing: border-box;
  }
  #certificate-wrapper{
    min-height: calc(100vh - 133px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  #certificate-container{
    width:854px;
    height:596px;
    margin: 0 auto;
    padding: 20px;
    background-repeat: no-repeat;
    background-size: cover;  
    background-image: url('${background_image_suivi}')
  }
  #pdf-btn-wrapper{
    padding: 15px
  }
  #certificate-title{
    text-transform: uppercase;
  }
  #noCertificateMessage{
    background: white;
    height: calc(100vh - 133px);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
  }

</style>

<!-- CUSTOM STYLE -->
<style>
  #certificate-container{
    font-family: 'Avenir Heavy';
  }

  #user-name {
    position: relative;
    top: 34px;
    font-family:'Avenir Heavy';
  }
  #users-grade {
    color: var(--blue);
    background-color: #D7D8D7;
    font-size: 20px;
    font-weight: 500;
    position: relative;
    top: 118px;
    left: 337px;
    width: 60px;
  }
  #graduation-date {
    color: var(--blue);
    font-size: 16px;
    font-weight: 500;
    position: relative;
    top : 149px;
    text-transform: none;
  }
  #course-name{
    color: #D7D8D7;
    font-size: 24px;
    width: 500px;
    text-transform: uppercase;
    position: relative;
    top: 113px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

</style>
% if grades.get('partial') or tma_verify_access(request.user).is_tma_team():
<div id="certificate-wrapper">
  <div id="pdf-btn-wrapper">
    <button id="custom-btn" onclick="CertificateToPdf()">TELECHARGER PDF</button>
  </div>
  <div id="certificate-container" class=" certificate-border">
      <div id="internal-border">
        <div id="certificate-title">
          <!-- <h3>Certificat de Réussite</h3> -->
        </div>
        <div>
          <h3 id="user-name" >${first_name} ${last_name}</h3>
          <h2 id="course-name"></h2> 
          <h2 id="users-grade" >${int(grades['grade']*100)}%.</h2>
          <h2 id="graduation-date">
            <span id="datetime"></span>
          </h2>
        </div>
        <div>
          </div>
      </div>
  </div>
</div>
%else:
  <div id="noCertificateMessage">
      <h3>Attestation de suivi non disponible</h3>
      <p>Vous n'avez pas progressé suffisamment pour obtenir votre attestation de suivi.</p>
  </div>
%endif

<!-- PDF CREATOR-->
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.debug.js"></script>
<script>
  function CertificateToPdf(){
     html2canvas(document.getElementById("certificate-container"), {
      onrendered : function (canvas){
       var img=canvas.toDataURL("image/png");
       var doc = new jsPDF({orientation: 'landscape'});
       doc.addImage(img, "PNG", 30, 35);
       doc.save("certificat.pdf");
      }
    })
  }
  //AVOID INTERNET EXPLORER NOT WORKING WITH HTML2CANVAS
  $(document).ready(function(){
    if(navigator.userAgent.indexOf("Firefox")<0 && navigator.userAgent.indexOf("Chrome")<0 && navigator.userAgent.indexOf("Safari")<0){
      $('#pdf-btn-wrapper').html("${_('Download PDF : This feature is not available on Internet Explorer. Please use Chrome Mozilla or Safari to get your pdf')}")
    }
  })
    
    // JOB
    let course_name = "${course_name}"
    document.getElementById("course-name").innerHTML = course_name.slice(9)

    // DATE

    date = new Date();
    var tab_mois=["janvier", "février", "mars", "avril", "mai", "juin", "juillet", "août", "septembre", "octobre", "novembre", "décembre"];
    var day = date.getDate();
    var monthIndex = date.getMonth();
    var year = date.getFullYear();

    document.getElementById("datetime").innerHTML = "Le " + day + " " + tab_mois[monthIndex]+ " " + year;
</script>

